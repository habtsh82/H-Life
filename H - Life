<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
        getFirestore, doc, setDoc, onSnapshot, enableIndexedDbPersistence 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // REPLACE THIS WITH YOUR NEW FIREBASE PROJECT CONFIG
    const firebaseConfig = {
  apiKey: "AIzaSyDnedUr-RQs_iOKKP3LSvlV1hjXxdyfaOI",
  authDomain: "h-life-tracker.firebaseapp.com",
  projectId: "h-life-tracker",
  storageBucket: "h-life-tracker.firebasestorage.app",
  messagingSenderId: "757300363968",
  appId: "1:757300363968:web:454e080f069f851c266325"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const docRef = doc(db, "data", "hab_life_state");

    // Enable Offline Support for the database
    enableIndexedDbPersistence(db).catch(err => console.log("Offline mode active"));

    // Register Service Worker for offline loading
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }

    // CLOUD SAVE FUNCTION
    window.saveData = async () => {
        try {
            // We save the global 'state' object used in your H-Life app
            await setDoc(docRef, state); 
            console.log("Synced to Cloud");
        } catch (e) {
            console.log("Saved to Local Phone Storage");
        }
    };

    // CLOUD LOAD & AUTO-REFRESH
    onSnapshot(docRef, (docSnap) => {
        if (docSnap.exists()) {
            const cloudData = docSnap.data();
            // Merge cloud data into our local state
            Object.assign(state, cloudData);
            
            // Re-render the dashboard to show changes immediately
            if (typeof renderDashboard === "function") renderDashboard();
        }
    });

    // --- YOUR ORIGINAL UI FUNCTIONS ---
    // Make sure your existing logic (renderDashboard, addTask, etc.) 
    // is pasted below this line or stays in the script.
</script>
